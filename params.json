{"name":"Gp-ark-tweet-nlp","tagline":"A PL/Java Wrapper on Ark-Tweet-NLP (http://www.ark.cs.cmu.edu/TweetNLP/) - Twitter Parts-of-speech tagger in Postgres/Greenplum","body":"Parts-of-speech tagging for Twitter via SQL\r\n=============================================\r\n\r\n`gp-ark-tweet-nlp` is a PL/Java Wrapper for [`Ark-Tweet-NLP`](http://www.ark.cs.cmu.edu/TweetNLP/) - a state-of-the-art parts-of-speech tagger for Twitter.\r\nThis package enables you to perform part-of-speech tagging on Tweets, using SQL. If your environment is an MPP system like Pivotal's Greenplum Database\r\nyou can piggyback on the MPP architecture and achieve implicit parallelism in your part-of-speech tagging tasks.\r\n\r\nThe GitHub page can be found at: http://vatsan.github.io/gp-ark-tweet-nlp/\r\n\r\nInstallation\r\n=============\r\n\r\nTo be able to use the PL/Java wrapper you'll need to ensure some pre-requisites are satisfied in your environment.\r\n\r\n\r\n### 1. Ensure PL/Java is installed and it works\r\n```SQL\r\n--Install PL/Java\r\nCREATE LANGUAGE pljava;\r\n\r\n-- Define function mapping\r\nDROP FUNCTION IF EXISTS getsysprop(varchar);\r\nCREATE FUNCTION getsysprop(varchar) \r\n     RETURNS varchar\r\nAS\r\n'java.lang.System.getProperty'\r\nLANGUAGE pljava;\r\n\t\t\t\t\r\n--Invoke function\r\nSELECT getsysprop('user.home');\r\n```\r\n\r\n### 2. Ensure `JAVA_HOME` is set on all hosts\r\nAs root run the following\r\n\r\n1. gpssh into all hosts\r\n```\r\n[gpadmin@mdw ~]$ gpssh -f <hostfile> ;\r\n```\r\n\r\n2. In the gpssh prompt, run the following:\r\n```\r\n[gpadmin@mdw ~]$ echo \"export JAVA_HOME=/usr/java/jdk1.6.0_24\" >> /home/gpadmin/.bashrc\r\n```\r\n\r\n###3. Prepare the Greenplum/Postgres Environment to talk to our PL/Java wrapper\r\n1. Copy the Libraries: The packaged jar file [ `gp-ark-tweet-nlp.jar`](https://github.com/vatsan/gp-ark-tweet-nlp/tree/master/build) that located in the folder `build/`\r\n```\r\n[gpadmin@mdw ~]$ gpscp -f <hostfile> gp-ark-tweet-nlp.jar =:/usr/local/greenplum-db/lib/postgresql/java/\r\n[gpadmin@mdw ~]$ gpscp -f <hostfile> ark-tweet-nlp-0.3.2.jar =:/usr/local/greenplum-db/lib/postgresql/java/\r\n```\r\n\r\n2. Update the `CLASSPATH` for PL/Java so that it can find our libraries\r\n```\r\n[gpadmin@mdw ~]$ gpconfig -c pljava_classpath -v \\'gp-ark-tweet-nlp.jar:ark-tweet-nlp-0.3.2.jar:examples.jar\\'\r\n```\r\n\r\n3. To increase memory available to PL/Java run the following commands on the **Master Segment**\r\n```\r\n[gpadmin@mdw ~]$ gpconfig -c pljava_vmoptions -v \\'-Xmx512M\\' \r\n[gpadmin@mdw ~]$ gpstop -r\r\n```\r\n\r\n4. Ensure the options have taken effect \r\n```\r\n[gpadmin@mdw ~]$ gpconfig --show pljava_vmoptions\r\nValues on all segments are consistent\r\nGUC          : pljava_vmoptions\r\nMaster  value: -Xmx512M\r\nSegment value: -Xmx512M\r\n[gpadmin@mdw ~]$ \r\n```\r\n\r\nYou are now set to run the part-of-speech tagger in SQL by defining a **User Defined Function** to invoke the PL/Java wrapper and a **User Defined Type**\r\nto define the type of the returned result.\r\n\r\nUsage\r\n======\r\n\r\n1. We'll first declare a **UDT** to define the type of the result return by our part-of-speech tagger\r\n```SQL\r\n-- Define a type to hold [tweet_id, token_index, token, tag] items\r\nDROP TYPE IF EXISTS token_tag;\r\nCREATE TYPE token_tag\r\nAS\r\n(\r\n\tindx int, \r\n\ttoken text,\r\n\ttag text\r\n);\r\n```\r\n\r\n2. We'll then declare a **UDF** to invoke the PL/Java wrapper\r\n```SQL\r\nDROP FUNCTION IF EXISTS posdemo.tag_pos(varchar);\r\nCREATE FUNCTION posdemo.tag_pos(varchar)\r\n\tRETURNS SETOF token_tag\r\nAS \r\n\t'postagger.nlp.POSTagger.tagTweet'\r\nIMMUTABLE LANGUAGE JAVAU;\r\n```\r\nNote the use of `javau` instead of just `java` in the **UDF**. This is because we are using the untrusted version of PL/Java as the part-of-speech tagger has to read a model file from within `gp-ark-tweet-nlp.jar` \r\nWithout the untrusted language, we will encounter a `java.lang.SecurityException` when the code tries to read the model file embedded in `gp-ark-tweet-nlp.jar`.\r\n\r\n3. Finally we can invoke the parts-of-speech tagger on a table containing a tweet column like so:\r\n\r\n```SQL\r\nvatsandb=# \\d+ posdemo.training_data\r\n                        Table \"sentidemo.training_data\"\r\n   Column   |            Type             | Modifiers | Storage  | Description \r\n------------+-----------------------------+-----------+----------+-------------\r\n rating     | integer                     |           | plain    | \r\n id         | bigint                      |           | plain    | \r\n ts         | timestamp without time zone |           | plain    | \r\n query      | text                        |           | extended | \r\n poster     | text                        |           | extended | \r\n tweet_body | text                        |           | extended | \r\nHas OIDs: no\r\nDistributed by: (id)\r\n```\r\n\r\nHere are some sample rows from the table\r\n```SQL\r\nvatsandb=# select id, tweet_body from sentidemo.training_data limit 10;\r\n```\r\n\r\n```SQL\r\n     id     |                                                                tweet_body                                                                 \r\n------------+-------------------------------------------------------------------------------------------------------------------------------------------\r\n 1467820906 | @localtweeps Wow, tons of replies from you, may have to unfollow so I can see my friends' tweets, you're scrolling the feed a lot. \r\n 1467862806 | @MySteezRadio I'm goin' to follow u, since u didn't  LOL  GO ANGELS!\r\n 1467891880 | Argh! I was suuuper sleepy an hour ago, now I'm wide awake.  Hope I don't stay up all night. :-/\r\n 1467896211 | michigan state you make me sad \r\n 1467911846 | @bananaface IM SORRY I GOT YOU SICK.  lol. going to bed too. NIGHT!\r\n 1467962634 | Im in the mood for some chocolate. I want..... Miniature Reeses cups. Now \r\n 1467979881 | @redvinylgirl my mom has it. I wish you the best of luck \r\n 1467987712 | Change of plans, we ordered Macs instead. Time to hit the books! \r\n 1467996032 | Funny how the little things make me homesick, criminals breakn n2 a brownstone on LawNOrd CI made me misty \r\n 1468000208 | Man... taxes suck.  I'm horrified that i did something wrong on them.  TurboTax decided to keep around a lot of the stuff I turned off.  \r\n(10 rows)\r\n\r\nTime: 329.507 ms\r\n```\r\n\r\nNow we can perform parts-of-speech tagging of the tweets\r\n```SQL\r\nselect id, \r\n       (t).indx, \r\n       (t).token, \r\n       (t).tag\r\nfrom\r\n(\r\n    select id, \r\n           posdemo.tag_pos(tweet_body) as t\r\n    from posdemo.training_data\r\n) q\r\n```\r\n\r\nWhich returns (limitng to 10 rows for sampel output)\r\n```SQL\r\n     id     | indx |  token   | tag \r\n------------+------+----------+-----\r\n 1467810672 |    0 | is       | V\r\n 1467810672 |    1 | upset    | A\r\n 1467810672 |    2 | that     | P\r\n 1467810672 |    3 | he       | O\r\n 1467810672 |    4 | can't    | V\r\n 1467810672 |    5 | update   | V\r\n 1467810672 |    6 | his      | D\r\n 1467810672 |    7 | Facebook | ^\r\n 1467810672 |    8 | by       | P\r\n 1467810672 |    9 | texting  | V\r\n(10 rows)\r\n\r\n```\r\n\r\nQuestions?\r\n============\r\n\r\nYou can reach me at vatsan.cs@utexas.edu\r\n","google":"UA-42912291-1","note":"Don't delete this file! It's used internally to help with page regeneration."}